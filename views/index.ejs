<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snap Cart - Multi-University Student Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2C3E50;
            --secondary: #fff;
            --accent: #87CEEB;
            --light: #f0f8ff;
            --dark: #2C3E50;
            --gray: #708090;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(44, 62, 80, 0.7), rgba(44, 62, 80, 0.7)), url('https://images.unsplash.com/photo-1523050854058-8df90110c9f1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1000&q=80');
            background-size: cover;
            background-position: center;
            color: var(--secondary);
            padding: 100px 0;
            text-align: center;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 18px;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        
        .hero-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .cta-button {
            background-color: var(--secondary);
            color: var(--primary);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .cta-button:hover {
            background-color: var(--primary);
            color: var(--secondary);
        }
        
        .partner-button {
            background-color: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 15px;
        }
        
        .partner-button:hover {
            background-color: var(--secondary);
            color: var(--primary);
        }
        
        /* Featured Products */
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            text-align: center;
            margin: 60px 0 40px;
            position: relative;
        }
        
        .section-title:after {
            content: '';
            display: block;
            width: 60px;
            height: 2px;
            background-color: var(--primary);
            margin: 15px auto;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }
        
        .product-card {
            background-color: var(--secondary);
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .product-image {
            height: 200px;
            background-color: #f1f3f5;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-info {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .product-price {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .product-seller {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .contact-seller {
            background-color: var(--primary);
            color: var(--secondary);
            border: none;
            padding: 8px 15px;
            width: 100%;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: auto;
        }
        
        .contact-seller:hover {
            background-color: #333;
        }
        
        .contact-seller i {
            margin-right: 8px;
        }
        
        /* How it Works */
        .how-it-works {
            background-color: var(--secondary);
            padding: 60px 0;
        }
        
        .steps {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 40px;
        }
        
        .step {
            flex: 0 0 calc(33.333% - 30px);
            text-align: center;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .step-icon {
            width: 80px;
            height: 80px;
            background-color: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 30px;
        }
        
        .step h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
        }
        
        /* Footer */
        footer {
            background-color: var(--primary);
            color: var(--secondary);
            padding: 60px 0 30px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }
        
        .footer-column {
            flex: 0 0 calc(25% - 30px);
            margin-bottom: 30px;
        }
        
        .footer-column h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 10px;
        }
        
        .footer-column ul li a {
            color: #adb5bd;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-column ul li a:hover {
            color: var(--secondary);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid #343a40;
            color: #adb5bd;
            font-size: 14px;
        }
        
        .verified-badge-small {
            color: #ffd700;
            font-size: 12px;
            margin-left: 5px;
        }

        /* Image Viewer Modal */
        .image-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .image-viewer-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
        }

        .image-viewer-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .image-viewer-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .image-viewer-nav:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .image-viewer-prev {
            left: -70px;
        }

        .image-viewer-next {
            right: -70px;
        }

        .image-viewer-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .image-viewer-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .image-viewer-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 15px;
        }

        .image-count-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-image {
            cursor: pointer;
            transition: transform 0.3s;
        }

        .product-image:hover {
            transform: scale(1.02);
        }

        /* Ad Styles */
        .ad-carousel {
            max-width: 800px;
            margin: 40px auto;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .ad-carousel-container {
            position: relative;
            height: 300px;
        }

        .ad-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.5s ease;
            background: linear-gradient(135deg, var(--primary), var(--dark));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 40px;
        }

        .ad-slide.active {
            opacity: 1;
        }

        .ad-image {
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .ad-content {
            flex: 1;
            margin-left: 40px;
            color: var(--secondary);
        }

        .ad-content h3 {
            font-size: 28px;
            margin-bottom: 15px;
            font-family: 'Playfair Display', serif;
        }

        .ad-content p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .ad-link {
            display: inline-block;
            background-color: var(--accent);
            color: var(--secondary);
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        .ad-link:hover {
            background-color: #128C7E;
        }

        .ad-carousel-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .ad-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .ad-dot.active {
            background-color: var(--secondary);
        }

        /* Popup Ad Styles */
        .ad-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .ad-popup.show {
            display: flex;
        }

        .ad-popup-content {
            background-color: var(--secondary);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        .ad-popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 30px;
            cursor: pointer;
            color: red;
            background: yellow;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            border: 2px solid black;
        }

        .ad-popup-close:hover {
            color: var(--dark);
        }

        .ad-popup .ad-image {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .ad-popup h3 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .ad-popup p {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .ad-popup .ad-link {
            background-color: var(--primary);
            color: var(--secondary);
            padding: 12px 30px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            display: inline-block;
            transition: background-color 0.3s;
        }

        .ad-popup .ad-link:hover {
            background-color: var(--dark);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .no-products {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }
        
        /* Buyer Safety Section */
        .buyer-safety {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 30px 0;
            border-top: 2px solid #ffc107;
            border-bottom: 2px solid #ffc107;
        }
        
        .safety-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .safety-icon {
            font-size: 48px;
            color: #856404;
            flex-shrink: 0;
        }
        
        .safety-text h3 {
            color: #856404;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .safety-text p {
            color: #856404;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .safety-link {
            color: #856404;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }
        
        .safety-link:hover {
            color: #533f00;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            
            .hero h1 {
                font-size: 36px;
            }
            
            .hero-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .partner-button {
                margin-left: 0;
            }
            
            .step {
                flex: 0 0 100%;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                margin-bottom: 30px;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        
        /* Ad Styles */
        .ad-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .ad-popup-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            position: relative;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .ad-image {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .ad-link {
            display: inline-block;
            background-color: var(--accent);
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        
        .ad-link:hover {
            background-color: #1da851;
        }
        
        .ad-carousel {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 30px auto;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .ad-carousel-container {
            display: flex;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .ad-slide {
            min-width: 100%;
            display: none;
            background: linear-gradient(135deg, #000 0%, #25D366 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .ad-slide.active {
            display: flex;
        }
        
        .ad-slide .ad-image {
            max-width: 350px;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .ad-slide .ad-image:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .ad-content h3 {
            font-size: 32px;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .ad-content p {
            font-size: 18px;
            margin-bottom: 25px;
            opacity: 0.95;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .ad-carousel-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }
        
        .ad-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .ad-dot.active {
            background-color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .ad-popup-content {
                padding: 20px;
                margin: 20px;
            }
            
            .ad-slide {
                padding: 30px 20px;
            }
            
            .ad-slide .ad-image {
                max-width: 100%;
                height: 150px;
            }
        }
        
        /* Enhanced responsive design for carousel */
        @media (min-width: 769px) and (max-width: 1199px) {
            .ad-carousel {
                max-width: 900px;
                margin: 40px auto;
            }
            
            .ad-slide {
                padding: 50px 30px;
                min-height: 280px;
            }
            
            .ad-slide .ad-image {
                max-width: 300px;
                height: 200px;
            }
            
            .ad-content h3 {
                font-size: 28px;
            }
            
            .ad-content p {
                font-size: 16px;
            }
        }
        
        @media (min-width: 1200px) {
            .ad-carousel {
                max-width: 1400px;
                margin: 50px auto;
                box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
            }
            
            .ad-slide {
                padding: 80px 50px;
                min-height: 350px;
            }
            
            .ad-slide .ad-image {
                max-width: 400px;
                height: 280px;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            }
            
            .ad-content h3 {
                font-size: 36px;
                margin-bottom: 25px;
            }
            
            .ad-content p {
                font-size: 20px;
                max-width: 700px;
            }
        }

        /* University Categories */
        .university-categories {
            padding: 80px 0;
            background: var(--secondary);
        }

        .university-categories .section-title {
            text-align: center;
            margin-bottom: 10px;
        }

        .section-subtitle {
            text-align: center;
            color: var(--gray);
            font-size: 16px;
            margin-bottom: 50px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .universities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .university-card {
            background: var(--secondary);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .university-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .university-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .university-header h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
        }

        .seller-count {
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .university-sellers {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .seller-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--light);
            padding: 8px 12px;
            border-radius: 25px;
            flex: 1;
            min-width: 0;
        }

        .seller-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .seller-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .default-avatar {
            width: 100%;
            height: 100%;
            background: var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .seller-info h4 {
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .more-sellers {
            color: var(--gray);
            font-size: 13px;
            font-style: italic;
            padding: 8px 12px;
            background: var(--light);
            border-radius: 25px;
        }

        .view-university-btn {
            display: block;
            width: 100%;
            text-align: center;
            background: var(--primary);
            color: var(--secondary);
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .view-university-btn:hover {
            background: #333;
        }

        .no-universities {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        @media (max-width: 768px) {
            .universities-grid {
                grid-template-columns: 1fr;
            }

            .university-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .university-sellers {
                flex-direction: column;
            }

            .seller-item {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <%- include('./partials/header') %>

    <!-- Ads Section -->
    <% if (carouselAds && carouselAds.length > 0) { %>
        <!-- Ad Carousel -->
        <div class="ad-carousel">
            <div class="ad-carousel-container">
                <% carouselAds.forEach((ad, index) => { %>
                    <div class="ad-slide <%= index === 0 ? 'active' : '' %>" data-ad-id="<%= ad._id %>" data-rotation-interval="<%= ad.rotationInterval || 5 %>" data-auto-rotate="<%= ad.autoRotate !== false %>">
                        <% if (ad.image) { %>
                            <img src="<%= ad.image %>" alt="<%= ad.title %>" class="ad-image">
                        <% } %>
                        <div class="ad-content">
                            <h3><%= ad.title %></h3>
                            <p><%= ad.description %></p>
                            <% if (ad.link) { %>
                                <a href="<%= ad.link %>" class="ad-link" target="_blank">Learn More</a>
                            <% } %>
                        </div>
                    </div>
                <% }); %>
            </div>
            <% if (carouselAds.length > 1) { %>
                <div class="ad-carousel-dots">
                    <% carouselAds.forEach((ad, index) => { %>
                        <span class="ad-dot <%= index === 0 ? 'active' : '' %>" data-slide="<%= index %>"></span>
                    <% }); %>
                </div>
            <% } %>
        </div>
    <% } %>

    <!-- Popup Ads Container (hidden by default) -->
    <div id="popup-ads-container">
        <% if (popupAds && popupAds.length > 0) { %>
            <% popupAds.filter(ad => ad.title !== 'welcome to snap cart').forEach(ad => { %>
                <div class="ad-popup" data-ad-id="<%= ad._id %>" data-display-delay="<%= ad.displayDelay || 5 %>" data-duration="<%= ad.duration || 10 %>" data-frequency="<%= ad.frequency || 'once-per-session' %>" data-max-displays="<%= ad.maxDisplays || 3 %>" data-auto-hide="<%= ad.autoHide !== false %>" data-show-close="<%= ad.showCloseButton !== false %>">
                    <div class="ad-popup-content">
                        <% if (ad.showCloseButton !== false) { %>
                            <span class="ad-popup-close">&times;</span>
                        <% } %>
                        <% if (ad.image) { %>
                            <img src="<%= ad.image %>" alt="<%= ad.title %>" class="ad-image">
                        <% } %>
                        <h3><%= ad.title %></h3>
                        <p><%= ad.description %></p>
                        <% if (ad.link) { %>
                            <a href="<%= ad.link %>" class="ad-link" target="_blank">Learn More</a>
                        <% } %>
                    </div>
                </div>
            <% }); %>
        <% } %>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Welcome to Snap Cart</h1>
            <p>The premier marketplace for University of Ibadan students to buy and sell products within the campus community.</p>
            <div class="hero-buttons">
                <a href="/products" class="cta-button">Start Shopping</a>
                <a href="https://wa.me/YOUR_WHATSAPP_NUMBER?text=Hi%20Snap%20Cart%20Team,%20I'm%20interested%20in%20partnership%20opportunities" class="partner-button" target="_blank">
                    <i class="fab fa-whatsapp"></i> Partner with Us
                </a>
            </div>
        </div>
    </section>

    <!-- Buyer Safety Section -->
    <section class="buyer-safety">
        <div class="container">
            <div class="safety-content">
                <div class="safety-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="safety-text">
                    <h3>Stay Safe While Shopping</h3>
                    <p>Remember to meet sellers in safe, public locations on campus and never send money before inspecting items.</p>
                    <a href="/products" class="safety-link">View Safety Tips <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="container">
        <h2 class="section-title">Featured Products</h2>
        <div class="products-grid">
            <% if (featuredProducts && featuredProducts.length > 0) { %>
                <% featuredProducts.forEach(product => { %>
                    <div class="product-card" data-images="<%= JSON.stringify(product.images || [product.image].filter(Boolean)) %>" data-title="<%= product.title %>">
                        <div class="product-image" onclick="openImageViewer(this.closest('.product-card'))">
                            <% 
                            const displayImages = product.images || [product.image].filter(Boolean);
                            const mainImage = displayImages.length > 0 ? displayImages[0] : null;
                            %>
                            <% if (mainImage) { %>
                                <img src="<%= mainImage %>" alt="<%= product.title %>">
                                <% if (displayImages.length > 1) { %>
                                    <div class="image-count-badge">
                                        <i class="fas fa-images"></i> <%= displayImages.length %>
                                    </div>
                                <% } %>
                            <% } else { %>
                                <img src="https://images.unsplash.com/photo-1546868871-7041f2a55e12?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80" alt="<%= product.title %>">
                            <% } %>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title"><%= product.title %></h3>
                            <p class="product-price"><%= product.price %></p>
                            <p class="product-seller">
                                Posted by: <a href="/seller/<%= product.seller ? product.seller._id : '' %>" style="color: var(--primary); text-decoration: none; font-weight: 500;"><%= product.seller ? (product.seller.shopName || product.seller.name) : 'UI Student' %></a>
                                <% if (product.seller && product.seller.verified) { %>
                                    <span class="verified-badge-small" title="Verified Seller">
                                        <i class="fas fa-check-circle"></i>
                                    </span>
                                <% } %>
                            </p>
                            <% if (product.seller && product.seller.whatsapp) { %>
                                <%
                                const defaultMessage = `Hi! I'm interested in your ${product.title} listed on Snap Cart.`;
                                const whatsappMessage = product.whatsappMessage || defaultMessage;
                                const encodedMessage = encodeURIComponent(whatsappMessage);
                                %>
                                <a href="https://wa.me/<%= product.seller.whatsapp %>?text=<%= encodedMessage %>" 
                                   class="contact-seller" target="_blank">
                                    <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                                </a>
                            <% } else { %>
                                <button class="contact-seller" disabled>
                                    <i class="fab fa-whatsapp"></i> Contact via WhatsApp
                                </button>
                            <% } %>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="no-products">
                    <p>No featured products available yet. Products from verified sellers will appear here.</p>
                </div>
            <% } %>
        </div>
    </section>

    <!-- University Categories -->
    <section class="university-categories">
        <div class="container">
            <h2 class="section-title">Shop by University</h2>
            <p class="section-subtitle">Find sellers from your university and discover products from fellow students</p>
            
            <% if (universities && universities.length > 0) { %>
                <div class="universities-grid">
                    <% universities.forEach(university => { %>
                        <div class="university-card">
                            <div class="university-header">
                                <h3><%= university.displayName %></h3>
                                <span class="seller-count"><%= university.sellers.length %> seller<%= university.sellers.length !== 1 ? 's' : '' %></span>
                            </div>
                            <div class="university-sellers">
                                <% university.sellers.slice(0, 3).forEach(seller => { %>
                                    <div class="seller-item">
                                        <div class="seller-avatar">
                                            <% if (seller.profileImage) { %>
                                                <img src="<%= seller.profileImage %>" alt="<%= seller.name %>">
                                            <% } else { %>
                                                <div class="default-avatar">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                            <% } %>
                                        </div>
                                        <div class="seller-info">
                                            <h4><%= seller.name %></h4>
                                        </div>
                                    </div>
                                <% }); %>
                                <% if (university.sellers.length > 3) { %>
                                    <div class="more-sellers">
                                        +<%= university.sellers.length - 3 %> more seller<%= university.sellers.length - 3 !== 1 ? 's' : '' %>
                                    </div>
                                <% } %>
                            </div>
                            <a href="/university/<%= university.name.replace(/\s+/g, '-').toLowerCase() %>" class="view-university-btn">
                                View All Sellers
                            </a>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="no-universities">
                    <p>No approved sellers yet. Be the first to apply and start selling!</p>
                </div>
            <% } %>
        </div>
    </section>

    <!-- How it Works -->
    <section class="how-it-works">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h3>Create an Account</h3>
                    <p>Register as a UI student with a valid email address.</p>
                </div>
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-tag"></i>
                    </div>
                    <h3>List Your Products</h3>
                    <p>Post items you want to sell with photos, description, and price.</p>
                </div>
                <div class="step">
                    <div class="step-icon">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <h3>Connect via WhatsApp</h3>
                    <p>Buyers contact you directly through WhatsApp to arrange purchase.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Snap Cart</h3>
                    <p>The marketplace exclusively for University of Ibadan students.</p>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/products">Products</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/privacy-policy">Privacy Policy</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Categories</h3>
                    <ul>
                        <li><a href="#">Textbooks</a></li>
                        <li><a href="#">Electronics</a></li>
                        <li><a href="#">Fashion</a></li>
                        <li><a href="#">Furniture</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <ul>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Email</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Snap Cart - Multi-University Student Marketplace. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Ad Popup Functionality
        const adPopup = document.getElementById('ad-popup');
        if (adPopup) {
            const closeBtn = adPopup.querySelector('.ad-popup-close');
            
            // Show popup after page load
            setTimeout(() => {
                adPopup.style.display = 'flex';
            }, 1000);
            
            // Close popup when clicking close button
            closeBtn.addEventListener('click', () => {
                adPopup.style.display = 'none';
            });
            
            // Close popup when clicking outside
            adPopup.addEventListener('click', (e) => {
                if (e.target === adPopup) {
                    adPopup.style.display = 'none';
                }
            });
        }
        
        // Ad Carousel Functionality
        const carousel = document.querySelector('.ad-carousel');
        if (carousel) {
            const slides = carousel.querySelectorAll('.ad-slide');
            const dots = carousel.querySelectorAll('.ad-dot');
            let currentSlide = 0;
            
            function showSlide(index) {
                slides.forEach(slide => slide.classList.remove('active'));
                dots.forEach(dot => dot.classList.remove('active'));
                
                slides[index].classList.add('active');
                dots[index].classList.add('active');
                currentSlide = index;
            }
            
            // Auto slide every 5 seconds
            setInterval(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                showSlide(currentSlide);
            }, 5000);
            
            // Dot navigation
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    showSlide(index);
                });
            });
        }

        // Image Viewer functionality
        let currentImages = [];
        let currentImageIndex = 0;

        function openImageViewer(productCard) {
            const imagesData = productCard.getAttribute('data-images');
            const title = productCard.getAttribute('data-title');
            
            try {
                currentImages = JSON.parse(imagesData);
                currentImageIndex = 0;
                
                if (currentImages.length > 0) {
                    updateImageViewer();
                    const modal = document.getElementById('imageViewerModal');
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            } catch (e) {
                console.error('Error parsing image data:', e);
            }
        }

        function closeImageViewer() {
            const modal = document.getElementById('imageViewerModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function nextImage() {
            if (currentImages.length > 1) {
                currentImageIndex = (currentImageIndex + 1) % currentImages.length;
                updateImageViewer();
            }
        }

        function prevImage() {
            if (currentImages.length > 1) {
                currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
                updateImageViewer();
            }
        }

        function updateImageViewer() {
            const imageElement = document.getElementById('imageViewerImage');
            const counterElement = document.getElementById('imageViewerCounter');
            
            if (currentImages.length > 0) {
                imageElement.src = currentImages[currentImageIndex];
                counterElement.textContent = `${currentImageIndex + 1} / ${currentImages.length}`;
            }
        }

        // Close modal when clicking outside
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('imageViewerModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeImageViewer();
                    }
                });
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageViewerModal');
            if (modal && modal.style.display === 'flex') {
                if (e.key === 'Escape') {
                    closeImageViewer();
                } else if (e.key === 'ArrowLeft') {
                    prevImage();
                } else if (e.key === 'ArrowRight') {
                    nextImage();
                }
            }
        });

        // Ad Management System
        class AdManager {
            constructor() {
                this.popupAds = [];
                this.carouselAds = [];
                this.currentCarouselIndex = 0;
                this.carouselInterval = null;
                this.sessionStorageKey = 'ad_display_counts';
                this.init();
            }

            init() {
                console.log('Initializing AdManager');
                // Store reference for event listeners
                const self = this;
                // Initialize popup ads
                const popupElements = document.querySelectorAll('.ad-popup[data-ad-id]');
                console.log('Found popup elements:', popupElements.length);
                popupElements.forEach(element => {
                    const adData = {
                        element: element,
                        id: element.dataset.adId,
                        displayDelay: parseInt(element.dataset.displayDelay) || 5,
                        duration: parseInt(element.dataset.duration) || 10,
                        frequency: element.dataset.frequency || 'once-per-session',
                        maxDisplays: parseInt(element.dataset.maxDisplays) || 3,
                        autoHide: element.dataset.autoHide === 'true',
                        showClose: element.dataset.showClose === 'true',
                        displayCount: this.getDisplayCount(element.dataset.adId),
                        timeoutId: null
                    };
                    this.popupAds.push(adData);
                    console.log('Added popup ad:', adData.id, 'displayDelay:', adData.displayDelay);
                });

                // Initialize carousel ads
                const carouselSlides = document.querySelectorAll('.ad-slide[data-ad-id]');
                carouselSlides.forEach((slide, index) => {
                    const adData = {
                        element: slide,
                        id: slide.dataset.adId,
                        rotationInterval: parseInt(slide.dataset.rotationInterval) || 5,
                        autoRotate: slide.dataset.autoRotate === 'true'
                    };
                    this.carouselAds.push(adData);
                });

                this.startPopupAds();
                this.startCarouselRotation();
                this.setupEventListeners();
            }

            getDisplayCount(adId) {
                const counts = JSON.parse(localStorage.getItem(this.sessionStorageKey) || '{}');
                return counts[adId] || 0;
            }

            incrementDisplayCount(adId) {
                const counts = JSON.parse(localStorage.getItem(this.sessionStorageKey) || '{}');
                counts[adId] = (counts[adId] || 0) + 1;
                localStorage.setItem(this.sessionStorageKey, JSON.stringify(counts));
            }

            shouldShowPopupAd(ad) {
                const now = Date.now();
                const lastShown = localStorage.getItem(`ad_last_shown_${ad.id}`);
                
                switch (ad.frequency) {
                    case 'once-per-session':
                        return ad.displayCount < 1;
                    case 'every-visit':
                        return true;
                    case 'once-per-day':
                        return !lastShown || (now - parseInt(lastShown)) > 24 * 60 * 60 * 1000;
                    default:
                        return ad.displayCount < ad.maxDisplays;
                }
            }

            startPopupAds() {
                this.popupAds.forEach(ad => {
                    if (this.shouldShowPopupAd(ad)) {
                        ad.timeoutId = setTimeout(() => {
                            this.showPopupAd(ad);
                        }, ad.displayDelay * 1000);
                    }
                });
            }

            showPopupAd(ad) {
                console.log('Showing popup ad:', ad.id);
                ad.element.classList.add('show');
                this.incrementDisplayCount(ad.id);
                localStorage.setItem(`ad_last_shown_${ad.id}`, Date.now().toString());

                // Note: Close button handling is done via event delegation in setupEventListeners()

                // Attach click outside to close
                ad.element.onclick = (e) => {
                    if (e.target === ad.element) {
                        console.log('Clicked outside popup');
                        this.hidePopupAd(ad);
                    }
                };

                // Auto-hide if enabled
                if (ad.autoHide) {
                    setTimeout(() => {
                        this.hidePopupAd(ad);
                    }, ad.duration * 1000);
                }
            }

            hidePopupAd(ad) {
                ad.element.classList.remove('show');
            }

            startCarouselRotation() {
                if (this.carouselAds.length <= 1) return;

                // Find the first ad with autoRotate enabled
                const autoRotateAd = this.carouselAds.find(ad => ad.autoRotate);
                if (!autoRotateAd) return;

                this.carouselInterval = setInterval(() => {
                    this.rotateCarousel();
                }, autoRotateAd.rotationInterval * 1000);
            }

            rotateCarousel() {
                const slides = document.querySelectorAll('.ad-slide');
                const dots = document.querySelectorAll('.ad-dot');
                
                slides[this.currentCarouselIndex].classList.remove('active');
                dots[this.currentCarouselIndex].classList.remove('active');
                
                this.currentCarouselIndex = (this.currentCarouselIndex + 1) % slides.length;
                
                slides[this.currentCarouselIndex].classList.add('active');
                dots[this.currentCarouselIndex].classList.add('active');
            }

            setupEventListeners() {
                console.log('Setting up event listeners');
                // Popup close buttons - use event delegation
                document.addEventListener('click', (e) => {
                    console.log('Document click detected, target:', e.target, 'class:', e.target.className);
                    if (e.target.classList.contains('ad-popup-close')) {
                        console.log('Close button clicked via delegation');
                        e.preventDefault();
                        e.stopPropagation();
                        const popup = e.target.closest('.ad-popup');
                        if (popup) {
                            console.log('Found popup element:', popup.dataset.adId);
                            const ad = this.popupAds.find(ad => ad.element === popup);
                            if (ad) {
                                console.log('Found ad object, hiding popup');
                                this.hidePopupAd(ad);
                            } else {
                                console.log('Ad not found in popupAds array, hiding directly');
                                popup.classList.remove('show');
                            }
                        }
                    }
                });

                // Carousel dots
                document.querySelectorAll('.ad-dot').forEach((dot, index) => {
                    dot.addEventListener('click', () => {
                        this.goToCarouselSlide(index);
                    });
                });

                // Pause carousel on hover
                const carousel = document.querySelector('.ad-carousel');
                if (carousel) {
                    carousel.addEventListener('mouseenter', () => {
                        if (this.carouselInterval) {
                            clearInterval(this.carouselInterval);
                        }
                    });

                    carousel.addEventListener('mouseleave', () => {
                        this.startCarouselRotation();
                    });
                }
            }

            goToCarouselSlide(index) {
                const slides = document.querySelectorAll('.ad-slide');
                const dots = document.querySelectorAll('.ad-dot');
                
                slides[this.currentCarouselIndex].classList.remove('active');
                dots[this.currentCarouselIndex].classList.remove('active');
                
                this.currentCarouselIndex = index;
                
                slides[this.currentCarouselIndex].classList.add('active');
                dots[this.currentCarouselIndex].classList.add('active');
            }
        }

        // Initialize ad manager when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            new AdManager();
        });
    </script>

    <!-- Image Viewer Modal -->
    <div id="imageViewerModal" class="image-viewer-modal">
        <div class="image-viewer-content">
            <button class="image-viewer-close" onclick="closeImageViewer()">&times;</button>
            <button class="image-viewer-nav image-viewer-prev" onclick="prevImage()">&#10094;</button>
            <img id="imageViewerImage" class="image-viewer-image" src="" alt="">
            <button class="image-viewer-nav image-viewer-next" onclick="nextImage()">&#10095;</button>
            <div id="imageViewerCounter" class="image-viewer-counter">1 / 1</div>
        </div>
    </div>
</body>
</html>