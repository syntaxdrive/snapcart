<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= isEditing ? 'Edit Ad' : 'Create New Ad' %> - Sellit Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css            <div class="carousel-settings" id="carouselSettings">>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2C3E50;
            --secondary: #fff;
            --accent: #87CEEB;
            --light: #f0f8ff;
            --dark: #2C3E50;
            --gray: #708090;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .form-container {
            background: var(--secondary);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 600px;
        }

        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .form-header h1 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .form-header p {
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--primary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .display-type-section,
        .popup-settings,
        .carousel-settings {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .display-type-section h3,
        .popup-settings h3,
        .carousel-settings h3 {
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 16px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--secondary);
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--gray);
            margin-left: 10px;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .current-image {
            margin-top: 10px;
            max-width: 200px;
            border-radius: 8px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.3s;
            background: #f8f9fa;
        }

        .file-input-label:hover {
            border-color: var(--primary);
        }

        .file-input-label i {
            margin-right: 10px;
            color: var(--gray);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn-secondary {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1><%= isEditing ? 'Edit Ad' : 'Create New Ad' %></h1>
            <p><%= isEditing ? 'Update the advertisement details' : 'Fill in the details to create a new advertisement' %></p>
            <% if (typeof error !== 'undefined') { %>
                <div style="background: var(--danger); color: white; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <%= error %>
                </div>
            <% } %>
        </div>

        <form action="<%= isEditing ? `/admin/ad/${ad._id}/edit` : '/admin/ad/new' %>" method="POST" enctype="multipart/form-data" onsubmit="return validateForm()">
            <div class="form-group">
                <label for="title">Title *</label>
                <input type="text" id="title" name="title" value="<%= ad ? ad.title : '' %>" required>
            </div>

            <div class="form-group">
                <label for="description">Description *</label>
                <textarea id="description" name="description" required><%= ad ? ad.description : '' %></textarea>
            </div>

            <div class="form-group">
                <label for="link">Link (optional)</label>
                <input type="url" id="link" name="link" value="<%= ad ? ad.link : '' %>" placeholder="https://example.com">
            </div>

            <div class="form-group">
                <label for="image">Image</label>
                <div class="file-input-wrapper">
                    <input type="file" id="image" name="image" accept="image/*">
                    <label for="image" class="file-input-label">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Choose Image
                    </label>
                </div>
                <% if (ad && ad.image) { %>
                    <img src="<%= ad.image %>" alt="Current image" class="current-image">
                <% } %>
            </div>

            <div class="display-type-section">
                <h3>Display Settings</h3>

                <div class="form-group">
                    <label for="displayType">Display Type *</label>
                    <select id="displayType" name="displayType" required>
                        <option value="carousel" <%= ad && ad.displayType === 'carousel' ? 'selected' : '' %>>Carousel (Homepage)</option>
                        <option value="popup" <%= ad && ad.displayType === 'popup' ? 'selected' : '' %>>Popup</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="priority">Priority (0-10)</label>
                        <input type="number" id="priority" name="priority" value="<%= ad ? ad.priority || 0 : 0 %>" min="0" max="10">
                    </div>

                    <div class="form-group">
                        <label for="active">Active</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="active" name="active" <%= ad && ad.active ? 'checked' : '' %>>
                            <label for="active">Enable this ad</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="popup-settings" id="popupSettings">
                <h3>Popup Settings</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="displayDelay">Display Delay (seconds)</label>
                        <input type="number" id="displayDelay" name="displayDelay" value="<%= ad ? ad.displayDelay || 5 : 5 %>" min="0">
                    </div>

                    <div class="form-group">
                        <label for="duration">Duration (seconds)</label>
                        <input type="number" id="duration" name="duration" value="<%= ad ? ad.duration || 10 : 10 %>" min="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="frequency">Frequency</label>
                        <select id="frequency" name="frequency">
                            <option value="every-visit" <%= ad && ad.frequency === 'every-visit' ? 'selected' : '' %>>Every Visit</option>
                            <option value="once-per-session" <%= ad && ad.frequency === 'once-per-session' ? 'selected' : '' %>>Once Per Session</option>
                            <option value="once-per-day" <%= ad && ad.frequency === 'once-per-day' ? 'selected' : '' %>>Once Per Day</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="maxDisplays">Max Displays</label>
                        <input type="number" id="maxDisplays" name="maxDisplays" value="<%= ad ? ad.maxDisplays || 3 : 3 %>" min="1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="autoHide">Auto Hide</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoHide" name="autoHide" <%= ad && ad.autoHide ? 'checked' : '' %>>
                            <label for="autoHide">Automatically hide after duration</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="showCloseButton">Show Close Button</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showCloseButton" name="showCloseButton" <%= ad && ad.showCloseButton ? 'checked' : '' %>>
                            <label for="showCloseButton">Allow users to close the popup</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="carousel-settings" id="carouselSettings">
                <h3>Carousel Settings</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="rotationInterval">Rotation Interval (seconds)</label>
                        <input type="number" id="rotationInterval" name="rotationInterval" value="<%= ad ? ad.rotationInterval || 5 : 5 %>" min="1">
                    </div>

                    <div class="form-group">
                        <label for="autoRotate">Auto Rotate</label>
                        <div class="checkbox-group">
                            <input type="checkbox" id="autoRotate" name="autoRotate" <%= ad && ad.autoRotate ? 'checked' : '' %>>
                            <label for="autoRotate">Automatically rotate slides</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn">
                    <%= isEditing ? 'Update Ad' : 'Create Ad' %>
                </button>
                <a href="/admin" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        // Function to update settings visibility
        function updateSettingsVisibility() {
            const displayType = document.getElementById('displayType').value;
            const popupSettings = document.getElementById('popupSettings');
            const carouselSettings = document.getElementById('carouselSettings');

            if (displayType === 'popup') {
                popupSettings.style.display = 'block';
                carouselSettings.style.display = 'none';
            } else {
                popupSettings.style.display = 'none';
                carouselSettings.style.display = 'block';
            }
        }

        // Form validation
        function validateForm() {
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const displayType = document.getElementById('displayType').value;

            if (!title) {
                alert('Title is required');
                return false;
            }

            if (!description) {
                alert('Description is required');
                return false;
            }

            if (!displayType) {
                alert('Display type is required');
                return false;
            }

            // Validate numeric fields
            const priority = document.getElementById('priority').value;
            if (priority && (isNaN(priority) || priority < 0 || priority > 10)) {
                alert('Priority must be a number between 0 and 10');
                return false;
            }

            if (displayType === 'popup') {
                const displayDelay = document.getElementById('displayDelay').value;
                const duration = document.getElementById('duration').value;
                const maxDisplays = document.getElementById('maxDisplays').value;

                if (displayDelay && (isNaN(displayDelay) || displayDelay < 0)) {
                    alert('Display delay must be a non-negative number');
                    return false;
                }

                if (duration && (isNaN(duration) || duration < 0)) {
                    alert('Duration must be a non-negative number');
                    return false;
                }

                if (maxDisplays && (isNaN(maxDisplays) || maxDisplays < 1)) {
                    alert('Max displays must be a number greater than 0');
                    return false;
                }
            }

            if (displayType === 'carousel') {
                const rotationInterval = document.getElementById('rotationInterval').value;

                if (rotationInterval && (isNaN(rotationInterval) || rotationInterval < 1)) {
                    alert('Rotation interval must be a number greater than 0');
                    return false;
                }
            }

            return true;
        }

        // Show/hide settings based on display type
        document.getElementById('displayType').addEventListener('change', updateSettingsVisibility);

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', updateSettingsVisibility);

        // Update file input label when file is selected
        document.getElementById('image').addEventListener('change', function() {
            const file = this.files[0];
            const label = this.parentElement.querySelector('.file-input-label');

            if (file) {
                label.innerHTML = '<i class="fas fa-check"></i> ' + file.name;
                label.style.borderColor = 'var(--success)';
            } else {
                label.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Choose Image';
                label.style.borderColor = '#e9ecef';
            }
        });
    </script>
</body>
</html>